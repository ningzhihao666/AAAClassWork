第五部分：系统操作员

用况：更新系统
参与者：系统操作员
简要描述：系统操作员执行预定的更新流程，将新的应用程序版本、数据库脚本或配置文件安全地部署到生产环境，并在出现问题时执行回滚操作。
前置条件：当前系统有功能或性能上有提升或者更改的需要，或系统存在部分Bug需要进行修复
后置条件：系统组件版本更新，或系统成功回滚到上一个稳定版本。

事件流：

基本流：
1. 系统操作员登录运维管理平台并进入“系统更新”模块后，用况启动。
2. 系统显示更新仪表盘，包括“准备更新包”、“执行服务更新”、“执行数据库更新”、“监控与验证”等主要步骤。
3. 系统操作员按顺序执行更新流程。
   {执行更新流程}
4. 系统操作员确认所有更新步骤完成且系统稳定，用况终止。

备选流：

A1 “执行后端服务更新” （特定备选流）
扩展点及其触发条件： 在{执行更新流程}处，选择“执行服务更新”。
1. 系统操作员选择预先上传的应用程序包（如Docker镜像）和目标服务器集群。
2. 系统启动发布流程，在负载均衡器后逐步将流量切换到运行新版本服务的节点。
3. 系统操作员监控新版本节点的运行状态（如CPU、内存、错误日志）。
   {监控新服务状态}
4. 当所有流量都成功切换到新版本节点且运行稳定后，系统回收旧版本节点的资源。
5. 系统将“执行服务更新”步骤标记为完成。

A2 “执行数据库更新” （特定备选流）
扩展点及其触发条件：在{执行更新流程}处，选择“执行数据库更新”。
1. 系统操作员上传或选择需要执行的数据库更新脚本。
2. 系统首先在备份数据库上执行模拟运行，并生成影响报告。
   {执行更新脚本}
3. 系统操作员确认报告无误后，批准在生产数据库上执行脚本。
4. 系统执行更新脚本，并记录所有变更。
5. 系统将“执行数据库更新”步骤标记为完成。

A3 “执行回滚操作” （特定备选流）
扩展点及其触发条件：在{监控新服务状态}扩展点之后，当系统监控到关键指标（如错误率、响应时间）严重超标时。
1. 系统操作员在运维平台触发“一键回滚”操作。
2. 系统自动将负载均衡器的流量全部切回至旧版本的服务节点。
3. 如果更新包含数据库变更，系统执行预先生成的数据库回滚脚本，将数据恢复到更新前的状态。
4. 用况终止。

A4 “暂停与继续更新” （有界备选流）
扩展点及其触发条件：在{执行更新流程}中的任何步骤，当需要临时暂停以进行人工检查或等待指令时。
1. 系统操作员选择“暂停更新”。
2. 系统暂停当前自动化流程，并保持当前状态。系统在仪表盘上高亮显示“更新已暂停”。
3. 当系统操作员选择“继续更新”后，事件流从暂停点恢复执行。

A5 “处理更新前置检查失败” （特定备选流）
扩展点及其触发条件：在用况启动后，执行基本流第3步之前，当系统的健康检查或资源检查未通过时。
1. 系统在更新仪表盘上显示检查失败警告，并列出具体失败项（如：磁盘空间不足、存在未恢复的故障节点）。
2. 更新流程被阻止启动。
3. 系统操作员必须解决前置检查失败的问题后，才能重新启动更新流程。事件流恢复到基本流第1步。

A6 “处理更新包验证失败” （特定备选流）
扩展点及其触发条件：在备选流A1第1步之后，当系统检测到更新包的数字签名无效或完整性校验失败时。
1. 系统提示“更新包验证失败”，并中止部署流程。
2. 系统操作员需要重新获取有效的更新包并重新上传。
3. 事件流恢复：恢复到备选流A1第1步。
